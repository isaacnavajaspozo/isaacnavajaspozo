#!/bin/bash

# Pedir ESSID, tipo de seguridad y contraseña al usuario
read -p "Ingresa el ESSID (id): " id
read -p "Selecciona el tipo de seguridad (WEP o WPA/WPA2): " security
read -sp "Ingresa la contraseña (pass): " pass
echo

# Convertir el tipo de seguridad a minúsculas para evitar errores
security=$(echo "$security" | tr '[:upper:]' '[:lower:]')

# Seleccionar el método de conexión según el tipo de seguridad
if [ "$security" == "wep" ]; then
    # Conexión para redes WEP usando iwconfig
    echo "Conectando a la red Wi-Fi $id con seguridad WEP..."
    sudo iwconfig wlan0 essid "$id" key s:"$pass"
    sudo dhclient wlan0

    # Verificar si la conexión fue exitosa
    if [ $? -eq 0 ]; then
        echo "Conexión exitosa a $id usando WEP"
    else
        echo "No se pudo conectar a $id usando WEP. Verifica el ESSID y la contraseña."
    fi

elif [ "$security" == "wpa" ] || [ "$security" == "wpa2" ]; then
    # Conexión para redes WPA/WPA2 usando nmcli
    echo "Conectando a la red Wi-Fi $id con seguridad WPA/WPA2..."
    nmcli device wifi connect "$id" password "$pass" >/dev/null 2>&1

    # Verificar si la conexión fue exitosa
    if [ $? -eq 0 ]; then
        echo "Conexión exitosa a $id usando WPA/WPA2"
    else
        echo "No se pudo conectar a $id usando WPA/WPA2. Verifica el ESSID y la contraseña."
        echo "Intentando de nuevo utilizando wpa_supplicant..."

        # Crear un archivo de configuración temporal para wpa_supplicant
        sudo bash -c "wpa_passphrase \"$id\" \"$pass\" > /tmp/wpa_supplicant.conf"

        # Conectar a la red Wi-Fi usando wpa_supplicant
        sudo wpa_supplicant -B -i wlan0 -c /tmp/wpa_supplicant.conf
        sudo dhclient wlan0

        # Verificar nuevamente si la conexión fue exitosa
        if [ $? -eq 0 ]; then
            echo "Conexión exitosa a $id usando wpa_supplicant"
        else
            echo "No se pudo conectar a $id con ninguno de los métodos. Verifica los datos y la conexión."
        fi

        # Limpiar archivo temporal de configuración
        sudo rm /tmp/wpa_supplicant.conf
    fi

else
    echo "Tipo de seguridad no reconocido. Usa 'WEP' o 'WPA/WPA2'."
fi
